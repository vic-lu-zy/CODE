function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 16-Mar-2015 19:43:21.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 150xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [-1.630859375;-1.61376953125;-2.70751953125;-2.6904296875;-3.61328125;-3.59619140625;-4.5361328125;-4.55322265625;-5.25390625;-5.2880859375;-6.0400390625;-6.005859375;-6.5869140625;-6.60400390625;-7.03125;-7.01416015625;-7.35595703125;-7.32177734375;-7.73193359375;-7.783203125;-8.14208984375;-8.17626953125;-8.41552734375;-8.4326171875;-8.671875;-8.68896484375;-8.80859375;-8.79150390625;-8.8427734375;-8.8427734375;-8.85986328125;-8.89404296875;-8.9111328125;-8.89404296875;-8.9111328125;-8.85986328125;-8.9111328125;-8.9453125;-8.9453125;-8.9453125;-8.96240234375;-8.99658203125;-8.9794921875;-9.013671875;-9.013671875;-9.013671875;-9.0478515625;-9.0478515625;-9.013671875;-9.0478515625;-9.06494140625;-9.0478515625;-9.03076171875;-9.0478515625;-9.08203125;-9.0478515625;-9.013671875;-9.06494140625;-9.03076171875;-9.03076171875;-9.0478515625;-9.08203125;-9.0478515625;-9.0478515625;-9.06494140625;-9.03076171875;-9.03076171875;-8.99658203125;-9.013671875;-9.013671875;-9.013671875;-9.013671875;-9.0478515625;-9.0478515625;-9.0478515625;-9.03076171875;-9.06494140625;-9.06494140625;-9.0478515625;-9.0478515625;-9.08203125;-9.08203125;-9.0478515625;-9.06494140625;-9.06494140625;-9.08203125;-9.06494140625;-9.0478515625;-9.06494140625;-9.0478515625;-9.08203125;-9.06494140625;-9.013671875;-9.06494140625;-9.0478515625;-9.08203125;-9.0478515625;-9.0478515625;-9.06494140625;-9.013671875;-9.06494140625;-9.013671875;-9.013671875;-9.0478515625;-9.08203125;-9.0478515625;-9.013671875;-9.06494140625;-9.013671875;-8.9794921875;-9.0478515625;-9.03076171875;-9.03076171875;-9.03076171875;-9.013671875;-9.0478515625;-9.0478515625;-9.013671875;-9.013671875;-9.06494140625;-8.9794921875;-9.013671875;-9.0478515625;-9.08203125;-9.0478515625;-9.013671875;-9.06494140625;-9.013671875;-8.9794921875;-8.9794921875;-8.9794921875;-8.99658203125;-9.0478515625;-9.03076171875;-9.03076171875;-9.03076171875;-9.013671875;-8.99658203125;-9.013671875;-9.013671875;-8.9794921875;-9.0478515625;-9.03076171875;-9.03076171875;-9.03076171875;-9.013671875;-8.99658203125;-9.013671875;-9.013671875;-8.9794921875];
  x1_step1_gain = [0.4607424071991;0.416471784443315;0.339213250517598;0.300844656628718;0.258912768647282;0.232199546485261;0.203174603174603;0.187846824122908;0.167662709783054;0.159222546161322;0.142892028606314;0.138659444820582;0.126791518340814;0.123970944309927;0.116330587901164;0.113399778516058;0.107464252918798;0.105621454357916;0.0999390020739295;0.098096036402826;0.0940744143316491;0.0931014888055461;0.0912859371517718;0.0900912790058287;0.089198606271777;0.0877933769156575;0.0871396659929795;0.0864317366533024;0.0863042562157606;0.0864317366533024;0.0862406569112538;0.0856724534616189;0.0853600083359383;0.085422314911366;0.0852977925864223;0.0856724534616189;0.0854847125117395;0.0854847125117395;0.0853600083359383;0.085422314911366;0.0851116883116883;0.0845582163501239;0.0846805871407897;0.08461935750439;0.0845582163501239;0.0842538311220817;0.0843145327295183;0.0843145327295183;0.0842538311220817;0.0843753218663096;0.0843145327295183;0.0843145327295183;0.0842538311220817;0.0840118962157727;0.0841932168550874;0.0840118962157727;0.084072249589491;0.0839516294322607;0.0841326897401664;0.0841932168550874;0.0843145327295183;0.084072249589491;0.0840118962157727;0.0843145327295183;0.0839516294322607;0.0840118962157727;0.084072249589491;0.0841932168550874;0.084072249589491;0.0841326897401664;0.0841932168550874;0.0841326897401664;0.0839516294322607;0.0840118962157727;0.084072249589491;0.0842538311220817;0.0841326897401664;0.0839516294322607;0.0842538311220817;0.0840118962157727;0.0838313548915268;0.0838914490527394;0.0840118962157727;0.0840118962157727;0.0840118962157727;0.0838914490527394;0.0839516294322607;0.0842538311220817;0.084072249589491;0.0840118962157727;0.0839516294322607;0.084072249589491;0.0841932168550874;0.0840118962157727;0.0841326897401664;0.0841932168550874;0.0841326897401664;0.0843753218663096;0.084072249589491;0.084436198721913;0.084072249589491;0.0841326897401664;0.084436198721913;0.0840118962157727;0.0838313548915268;0.0840118962157727;0.0841932168550874;0.0839516294322607;0.0841326897401664;0.0842538311220817;0.0839516294322607;0.084072249589491;0.084072249589491;0.0841932168550874;0.0841326897401664;0.084072249589491;0.0840118962157727;0.0841932168550874;0.0841932168550874;0.0839516294322607;0.0842538311220817;0.0841326897401664;0.0840118962157727;0.0838914490527394;0.084072249589491;0.0841932168550874;0.0840118962157727;0.0841932168550874;0.0843753218663096;0.084436198721913;0.0842538311220817;0.0843145327295183;0.0841326897401664;0.084072249589491;0.084072249589491;0.084072249589491;0.084072249589491;0.0841932168550874;0.0841932168550874;0.0844971634863332;0.0845582163501239;0.0841326897401664;0.0842538311220817;0.084072249589491;0.0842538311220817;0.0842538311220817;0.0841932168550874;0.0841326897401664;0.0841326897401664;0.0841932168550874];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [3.4504195344225486;0.21810972532556872;0.10636555676386306];
  IW1_1 = [0.22155563707674139 0.32023996456549003 0.37645447965724066 0.081376092637213251 0.46449706847348254 0.018285210853403899 0.40689736168279822 0.051269264188284744 0.31376327120230463 -0.0063490568759070921 0.24312147171460036 0.00014742495295407389 0.11806683152955383 -0.099897951825727693 -0.15638146764513886 0.026011719860263374 -0.16667082491986099 -0.11359736035711369 0.071635651706202744 0.090873928741718624 -0.035582335610485384 -0.1221747862464469 -0.12529333647592539 -0.22452117273198427 0.10905813780158989 -0.21128506126020441 0.12323171115672624 -0.21815298522086857 0.13053648209563654 -0.080976310273911681 -0.12285741004318859 -0.0099400583379295922 0.084153239484944686 -0.030680298674947541 -0.18335185743738791 -0.20554454587175189 -0.11448733975285508 -0.056536167686500147 0.045929904564447219 -0.13179578488215704 -0.051301061215883487 -0.18953915784736833 0.065877151297725825 -0.0075216380872162817 0.068960496140723027 0.11053968435139766 0.094842940980095228 0.095074929942952371 0.16937388753239682 -0.036226691004835367 0.026610003278114521 -0.16336437604255322 -0.053385185887658254 -0.17515840362149951 -0.086970383181423971 -0.14833922037625663 -0.18486609852706881 0.026972640809489704 0.14187218260036558 0.041355869538715707 0.17919379141839503 -0.14672509646031473 -0.069002257601517347 0.17703229352268948 0.032368823416231964 0.032760985651506584 0.0058548027501455543 0.1824167286913233 0.032157620895251156 0.13869051674087499 -0.15802287332655701 -0.14552995020839299 0.14707778066382832 0.11717146613022716 0.065067288915128529 -0.011577917542929722 -0.12066680517378263 -0.030108509205784676 0.067858223255709518 -0.020118052650276948 -0.073843380695387401 0.097054060407823384 -0.10729461861176329 0.16337541869111055 0.1953470745472439 -0.056424797540297736 0.076351173220922344 -0.046680445159390932 -0.0083946713146864672 0.23461671993880159 0.096524402631577286 0.060117792419303158 -0.036771446970737684 0.19156035873368318 0.057733105270569282 0.24048976432974803 -0.046877347571970027 0.28500850990964133 0.0044364302515146146 0.26523813098305571 0.25606732960246514 0.0076880768053234601 0.0041901174900904432 0.20828923985076414 0.19344130828234263 0.2101975409518316 0.09828001786781819 0.11634223106222882 0.25210374435018951 0.026139769701686237 0.16554590374476527 0.2577170840535144 0.18099822059164059 0.29966786125759515 0.05618534152558001 0.31580808287608103 0.1222180089975409 0.0060401111508635707 -0.012691736701105039 0.21933542651217494 0.279253109195782 0.06249253702865773 0.26444767823066118 0.32984703092212631 0.18163283793464768 0.21053772906450702 -0.0040938344950978908 -0.011410454038171499 0.18511081402482837 0.27004918506905456 0.069378857546778999 0.29613665543586948 0.047304627876054113 0.35509798548885174 0.22346173782124801 0.060525764016248665 0.28294061368379969 0.32709898955036176 0.11447432116393298 0.29408224802453348 0.18330902850818809 -0.0099267572387466505 0.12796816311838366 0.013715960974917521 0.24828322416396301 0.041104073680989894 0.26252185130898864 0.012924352573379776 0.30653936401061194 0.2042032884361476;0.025965243935271172 -0.010758120649289805 0.11174406216477489 0.070769099839045599 -0.03953819824606386 0.23670434016803005 -0.095658298472771019 -0.094119881534466016 -0.040230390750353187 0.052689487326021779 -0.1567407841615833 -0.13071456238356641 0.067893380324160424 0.15108113547843752 -0.033362769421818789 0.15504789045760378 -0.19375893208862241 -0.1950729270629083 -0.13113301912547032 0.059238935993153247 0.10141768362138912 0.10344681203778688 0.18804286961302255 0.062313973651578661 0.011216460823954551 0.011140457013553904 0.036381795625578382 -0.043886949200081946 -0.017881503228409909 0.02394290037522508 -0.10490108204245643 0.1268801078509087 0.083600771775046989 -0.10658978185044249 0.096997739169319863 -0.023858893721049858 0.05099050912050062 -0.034864858207730234 0.0060387174469259579 0.13979847297587644 -0.17064955367063508 0.18775111796957122 -0.073016494147821576 -0.10966131321807289 0.1184628779316679 -0.21919331655178848 0.038732149583941521 0.14329217901084904 0.019036562511994558 0.048210522436907585 -0.048316788415485298 0.12792112901164243 0.13206895381740968 0.15020072693063072 -0.20857180792189051 0.18402370519062847 0.027925238736532857 -0.11062132915330179 0.13984839443248531 -0.14580408981411963 0.12610613688311584 0.1270984931372979 -0.091921802380826645 -0.19520318854259694 -0.063641211049643376 0.015623768808760641 0.065798652152758791 0.17267888639133269 -0.075787872274054105 0.09432071394315647 0.13481101152814504 -0.19763729639442745 -0.1648622294216458 0.034825821559824971 -0.1531944626480374 -0.1606272248678341 0.13536883141072012 -0.032333268649051519 0.074291440426716426 0.076016335212222924 0.12595472393736137 -0.0010099185106398302 -0.15636179778278753 -0.14699234149577556 0.0078286106198345445 0.11344239312016663 0.011957335331053424 -0.12914159327987179 -0.16319790502323817 -0.043283033168919717 0.0067051698218574922 0.13297047479371771 -0.096905144174733948 0.13466942532826418 -0.014300916792635225 0.15041880953374154 0.06852360106247804 -0.011656181481702513 -0.15705861427098158 -0.10649249312807402 -0.10277639395723946 -0.10952295137792048 -0.051330551603510424 0.075321879302867517 0.068809939043898455 -0.083867893222792048 -0.0060405988152555361 -0.016399891107347683 -0.0082042159286204869 -0.26173641732114417 0.11788475437073193 0.015616613445051459 0.048542339508431565 -0.074710072750647241 -0.083354877336654642 0.09817429862596587 -0.026166780834605392 0.011842678838420367 0.06210241328848231 -0.11517966468511555 -0.27153685143674394 -0.21711991507778991 -0.18700513978521072 -0.13578729042868937 -0.15142051867839632 -0.18830140387413929 -0.10146629224236733 -0.15435245320512173 0.044067573530165216 -0.15791468297702918 -0.11898498545019166 0.07613964112745597 0.10349033782666921 -0.066725117216778429 -0.069054613656110708 0.054343921981764715 0.082588593667565102 -0.094825638827229691 -0.081727749325924817 -0.078548418675402173 -0.039332187426692589 0.047222104993557876 -0.26131450878781459 -0.16019237730229327 -0.075644501392865757 -0.17730202315458216 0.097188363685645998 -0.24882451474312511 -0.16359782671082676 -0.21509963356816675;0.20572050035744094 0.29183047691835162 0.50190756207901832 0.35306501525380507 0.5361129849504177 0.33314843447978154 0.23055363221334643 0.29265827231337005 -0.03427453743925464 0.045941039656721604 0.11715447594633475 -0.20536837118067833 0.088735319285108666 0.080755953818640744 0.022108765168309692 -0.2102942019394439 -0.064735640645739029 -0.23340960983645651 -0.057140513823180458 -0.29357778083941882 -0.15843755834121023 -0.26991964603689517 -0.32640995345270074 -0.28968716012501344 -0.026256623340574315 0.013079829801114428 -0.35219816990934782 -0.26016297551171186 -0.0072352914119542516 -0.06513479842387257 -0.12975180634907366 -0.1854469232770137 0.019811193608545483 -0.012370192821008166 -0.24374307850206842 -0.051837719713046744 -0.12640580080839178 0.00036221679896561096 -0.25803620531781879 -0.11348743737507642 0.030726749830456312 -0.33051228287317685 -0.26773250315009134 -0.34572414635913534 -0.095823221912603951 -0.082906395053043203 -0.0083117451693025084 -0.0078953831747966413 0.0069145480539516014 -0.12737135956878792 -0.33059977094433624 -0.20533867825761618 -0.3119178154121901 -0.22639254050199908 -0.016967134051173116 -0.056548626035883787 -0.30477233034520756 -0.14879119595710327 -0.31106031916117272 -0.088633995345460598 -0.30084672740558549 -0.23987420511100715 -0.059952408926289148 -0.27506055135582352 -0.22943126890052881 -0.23376382077107502 -0.0094621370663960317 -0.059461830604700214 -0.24288711998474835 -0.022518597475329472 -0.12533620440635368 -0.35707821849851434 -0.17798245921787656 -0.2905487212218964 -0.09497662002122656 -0.1055301114355036 -0.21557882078680393 -0.024439647297263042 -0.22430719699595955 -0.12420870209144984 -0.34868358953390782 -0.21718366818984683 -0.27028142725490906 -0.25178910573039748 -0.099542908040758757 -0.10137542272858821 -0.14504850053682039 -0.13630277478531236 -0.074069422854779604 -0.010016964240005404 -0.3087669268012273 0.011083848268345804 -0.31925492717915582 -0.30710593388138208 -0.28856602000582027 -0.057824735784823431 -0.0012146024555577 -0.16599674592663458 -0.032785336043621952 0.018873862930524645 0.0024533373608309466 -0.21373879921967812 -0.27460442953531833 -0.31897395011060914 -0.20773373776255463 -0.032237953484118072 -0.12798403213097478 -0.15466908292128032 -0.035157957028859377 -0.19696052262344083 -0.15986425491635806 -0.36877251333782862 -0.26296510365765774 -0.086697854591372928 -0.28821829872006061 -0.10414388780944618 -0.15169431260507843 -0.29532985439769438 -0.19624982796827978 -0.3463950769901033 -0.35876001701759824 -0.37513392685924696 -0.30062133792151841 -0.097719192733765864 -0.18290087928981108 -0.032067719883218881 -0.28202185114832656 -0.12476851243354284 -0.089575844186305681 -0.057796966882244921 -0.21912925383550599 -0.27910748111790662 -0.17366966130745157 -0.18228181839915164 -0.28128703770936603 -0.21558862924090422 -0.099470023488253387 -0.3635962359238028 -0.1034108711310595 -0.12568229381689619 -0.31508419500627499 -0.22846499914369847 -0.15170323168508346 -0.055256194368059841 0.0077628354897709591 -0.16197400066137632 -0.23577761987880097 -0.18188296552135125 -0.10221364930638213 -0.16897815127534049];
  
  % Layer 2
  b2 = [1.0868357564716509;0.42924276348098406;-1.4715850376128592];
  LW2_1 = [1.899334228633214 -3.9862246919209192 -6.0855051064902632;-7.9061313895695697 3.0445684945191536 0.4449964188770148;5.9544956450221713 1.6016325176002235 4.8778873884642664];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n)
  nmax = max(n,[],1);
  n = bsxfun(@minus,n,nmax);
  numer = exp(n);
  denom = sum(numer,1); 
  denom(denom == 0) = 1;
  a = bsxfun(@rdivide,numer,denom);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end
